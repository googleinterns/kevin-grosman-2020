#!/usr/bin/env bash

#INPUT: a profile and a location for the dump
#OUTPUT: puts the clases-and-methods dump at the location

PROFILE=${1?"ERROR: need to provide a .prof filepath for the resulting profile"}
PACKAGE=${2:-com.google.android.apps.maps}
PHONE_PROFILE="/sdcard/profiles/profileIntersection_intersection.prof"


APK_LOCATION=$(adb shell "ls /data/app/${PACKAGE}*/base.apk")

adb push $PROFILE $PHONE_PROFILE 2>&1 >/dev/null
adb shell "profman --dump-classes-and-methods --profile-file=$PHONE_PROFILE --apk=$APK_LOCATION"
